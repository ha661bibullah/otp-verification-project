<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OTP Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="bg-white shadow-lg rounded-lg p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Login with OTP</h2>
    
    <div class="mb-4">
      <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
      <input id="email" type="email" placeholder="Enter your email" 
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
    </div>

    <button onclick="sendOtp()" id="sendOtpBtn"
      class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition disabled:bg-blue-300 disabled:cursor-not-allowed">
      Send OTP
    </button>

    <div id="otpSection" class="hidden mt-6">
      <div class="mb-4">
        <label for="otp" class="block text-sm font-medium text-gray-700 mb-2">Enter OTP</label>
        <input id="otp" type="text" placeholder="Enter 6-digit OTP" maxlength="6"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
      </div>

      <button onclick="verifyOtp()" id="verifyOtpBtn"
        class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition disabled:bg-green-300 disabled:cursor-not-allowed">
        Verify OTP
      </button>
    </div>

    <p id="message" class="text-center mt-4 text-sm"></p>
    
    <div class="mt-6 text-center">
      <p class="text-xs text-gray-500">OTP will be sent to your email and valid for 5 minutes</p>
    </div>
  </div>

  <script>
    const backendUrl = window.location.hostname === 'localhost' 
      ? 'http://localhost:5000' 
      : 'YOUR_RENDER_BACKEND_URL'; // রেন্ডার ব্যাকেন্ড URL এখানে দিন

    async function sendOtp() {
      const email = document.getElementById("email").value.trim();
      const sendOtpBtn = document.getElementById("sendOtpBtn");
      const message = document.getElementById("message");

      if (!email) {
        showMessage("Please enter your email", "error");
        return;
      }

      if (!validateEmail(email)) {
        showMessage("Please enter a valid email address", "error");
        return;
      }

      // বাটন ডিজেবল করুন
      sendOtpBtn.disabled = true;
      sendOtpBtn.textContent = "Sending OTP...";

      try {
        const res = await fetch(`${backendUrl}/send-otp`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });

        const data = await res.json();
        
        if (data.success) {
          showMessage("OTP sent to your email!", "success");
          document.getElementById("otpSection").classList.remove("hidden");
          document.getElementById("otp").focus();
          
          // রিসেন্ড টাইমার
          setTimeout(() => {
            sendOtpBtn.disabled = false;
            sendOtpBtn.textContent = "Send OTP";
          }, 30000); // 30 সেকেন্ড পর রিসেন্ড Allow
        } else {
          showMessage(data.error || "Failed to send OTP!", "error");
          sendOtpBtn.disabled = false;
          sendOtpBtn.textContent = "Send OTP";
        }
      } catch (error) {
        console.error("Error:", error);
        showMessage("Network error! Please try again.", "error");
        sendOtpBtn.disabled = false;
        sendOtpBtn.textContent = "Send OTP";
      }
    }

    async function verifyOtp() {
      const email = document.getElementById("email").value.trim();
      const otp = document.getElementById("otp").value.trim();
      const verifyOtpBtn = document.getElementById("verifyOtpBtn");
      const message = document.getElementById("message");

      if (!otp || otp.length !== 6) {
        showMessage("Please enter a valid 6-digit OTP", "error");
        return;
      }

      verifyOtpBtn.disabled = true;
      verifyOtpBtn.textContent = "Verifying...";

      try {
        const res = await fetch(`${backendUrl}/verify-otp`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, otp })
        });

        const data = await res.json();
        
        if (data.success) {
          showMessage("✅ OTP Verified! Login Successful.", "success");
          // লগিন সফল হলে রিডাইরেক্ট বা অন্য কাজ করুন
          setTimeout(() => {
            window.location.href = "/dashboard"; // আপনার ড্যাশবোর্ড URL
          }, 2000);
        } else {
          showMessage(data.error || "❌ Invalid OTP!", "error");
          verifyOtpBtn.disabled = false;
          verifyOtpBtn.textContent = "Verify OTP";
        }
      } catch (error) {
        console.error("Error:", error);
        showMessage("Network error! Please try again.", "error");
        verifyOtpBtn.disabled = false;
        verifyOtpBtn.textContent = "Verify OTP";
      }
    }

    function showMessage(text, type) {
      const message = document.getElementById("message");
      message.textContent = text;
      message.className = "text-center mt-4 text-sm font-medium " + 
        (type === "success" ? "text-green-600" : "text-red-600");
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // Enter key press handler
    document.getElementById("email").addEventListener("keypress", function(e) {
      if (e.key === "Enter") sendOtp();
    });

    document.getElementById("otp").addEventListener("keypress", function(e) {
      if (e.key === "Enter") verifyOtp();
    });
  </script>
</body>
</html>